{% extends "base.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col-12 text-center">
        <h1 class="text-white mb-4">ðŸ“Š Business Dashboard</h1>
    </div>
</div>

<!-- Metrics Cards -->
<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="metric-card text-center">
            <i class="fas fa-dollar-sign fa-2x mb-2"></i>
            <h3>PKR {{ data.total_revenue }}</h3>
            <p class="mb-0">Total Revenue</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="metric-card text-center">
            <i class="fas fa-shopping-cart fa-2x mb-2"></i>
            <h3>{{ data.total_sales }}</h3>
            <p class="mb-0">Total Sales</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="metric-card text-center">
            <i class="fas fa-boxes fa-2x mb-2"></i>
            <h3>{{ data.total_stock }}</h3>
            <p class="mb-0">Stock Items</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="metric-card text-center">
            <i class="fas fa-chart-line fa-2x mb-2"></i>
            <h3>PKR {{ data.profit }}</h3>
            <p class="mb-0">Net Profit</p>
        </div>
    </div>
</div>

<!-- Quick Sale -->
<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-plus me-2"></i>Quick Sale</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <input type="text" class="form-control" id="productName" placeholder="Product Name">
                </div>
                <div class="row">
                    <div class="col-6">
                        <input type="number" class="form-control" id="quantity" placeholder="Quantity" value="1">
                    </div>
                    <div class="col-6">
                        <input type="number" class="form-control" id="price" placeholder="Price" step="0.01">
                    </div>
                </div>
                <div class="mt-3">
                    <input type="text" class="form-control" id="customer" placeholder="Customer Name (Optional)">
                </div>
                <button class="btn btn-success w-100 mt-3" onclick="createQuickSale()">
                    <i class="fas fa-zap me-2"></i>Quick Sale
                </button>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-info me-2"></i>Quick Actions</h5>
            </div>
            <div class="card-body">
                <a href="/stock" class="btn btn-outline-primary w-100 mb-2">
                    <i class="fas fa-boxes me-2"></i>Manage Stock
                </a>
                <a href="/sales" class="btn btn-outline-success w-100 mb-2">
                    <i class="fas fa-shopping-cart me-2"></i>View Sales
                </a>
                <a href="/expenses" class="btn btn-outline-warning w-100 mb-2">
                    <i class="fas fa-receipt me-2"></i>Add Expense
                </a>
                <a href="/analytics" class="btn btn-outline-info w-100">
                    <i class="fas fa-chart-bar me-2"></i>View Analytics
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function createQuickSale() {
    const productName = document.getElementById('productName').value.trim();
    const quantity = parseInt(document.getElementById('quantity').value) || 1;
    const price = parseFloat(document.getElementById('price').value);
    const customer = document.getElementById('customer').value.trim() || 'Walk-in Customer';
    
    if (!productName || !price || price <= 0) {
        showError('Please enter valid product name and price');
        return;
    }
    
    const saleData = {
        customer: customer,
        items: [{
            name: productName,
            quantity: quantity,
            price: price,
            total: quantity * price
        }]
    };
    
    fetch('/create_sale', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(saleData)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            showSuccess('Quick Sale Created! Invoice: ' + result.invoice);
            document.getElementById('productName').value = '';
            document.getElementById('quantity').value = '1';
            document.getElementById('price').value = '';
            document.getElementById('customer').value = '';
            setTimeout(() => location.reload(), 1500);
        } else {
            showError('Error creating sale');
        }
    })
    .catch(error => {
        showError('Network error occurred');
    });
}
</script>
{% endblock %}